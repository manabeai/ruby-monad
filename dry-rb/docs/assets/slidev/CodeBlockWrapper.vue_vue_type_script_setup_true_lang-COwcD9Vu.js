import{g as E,h as I}from"../modules/unplugin-icons-CFfmFXWK.js";import{d as V,r as q,O as D,E as S,L as M,z as g,aN as T,D as $,f as h,o as r,i as b,j as z,e as j,g as K,t as R,T as u,n as x,b as L,k as O}from"../modules/vue-BEvEvfvk.js";import{v as N,ai as U,C as W,an as X,ak as F}from"../index-DbUhERds.js";import{u as G}from"./context-DoxqTwNj.js";import{_ as J}from"./TitleIcon.vue_vue_type_script_setup_true_lang-J68YQrpK.js";const P=["data-title"],Q={key:0,class:"slidev-code-block-title"},Y={class:"leading-1em"},Z=["title"],se=V({__name:"CodeBlockWrapper",props:{ranges:{type:Array,default:()=>[]},finally:{type:[String,Number],default:"last"},startLine:{type:Number,default:1},lines:{type:Boolean,default:N.lineNumbers},at:{type:[String,Number],default:"+1"},maxHeight:{type:String,default:void 0},title:{type:String,default:void 0}},setup(s){const e=s,{$clicksContext:n}=G(),o=q(),p=U();D(()=>{n.unregister(p)}),S(()=>{var t;(t=o.value)==null||t.classList.toggle("slidev-code-line-numbers",e.lines)}),M(()=>{var c;if(!n||!((c=e.ranges)!=null&&c.length))return;const t=n.calculateSince(e.at,e.ranges.length-1);n.register(p,t);const l=g(()=>t?Math.max(0,n.current-t.start+1):W),i=g(()=>e.finally==="last"?e.ranges.at(-1):e.finally.toString());S(()=>{if(!o.value)return;let d=e.ranges[l.value]??i.value;const y=d==="hide";o.value.classList.toggle(X,y),y&&(d=e.ranges[l.value+1]??i.value);const _=o.value.querySelector(".shiki"),k=Array.from(_.querySelectorAll("code > .line")),A=k.length;if(F(d,A,e.startLine,a=>[k[a]]),e.maxHeight){const a=Array.from(_.querySelectorAll(".line.highlighted"));a.reduce((C,B)=>B.offsetHeight+C,0)>o.value.offsetHeight?a[0].scrollIntoView({behavior:"smooth",block:"start"}):a.length>0&&a[Math.round((a.length-1)/2)].scrollIntoView({behavior:"smooth",block:"center"})}})});const{copied:f,copy:w}=T();function H(){var l,i;const t=(i=(l=o.value)==null?void 0:l.querySelector(".slidev-code"))==null?void 0:i.textContent;t&&w(t)}const m=$("activeTitle",null),v=g(()=>m===null&&e.title);return(t,l)=>{const i=E,c=I;return r(),h("div",{ref_key:"el",ref:o,class:x(["slidev-code-wrapper relative group",{"slidev-code-line-numbers":e.lines,active:u(m)===s.title}]),style:O({"max-height":e.maxHeight,"overflow-y":e.maxHeight?"scroll":void 0,"--start":e.startLine}),"data-title":s.title},[v.value?(r(),h("div",Q,[j(J,{title:s.title},null,8,["title"]),K("div",Y,R(s.title.replace(/~([^~]+)~/g,"").trim()),1)])):b("v-if",!0),z(t.$slots,"default"),u(N).codeCopy?(r(),h("button",{key:1,class:x(["slidev-code-copy absolute right-0 transition opacity-0 group-hover:opacity-20 hover:!opacity-100",v.value?"top-10":"top-0"]),title:u(f)?"Copied":"Copy",onClick:l[0]||(l[0]=d=>H())},[u(f)?(r(),L(i,{key:0,class:"p-2 w-8 h-8"})):(r(),L(c,{key:1,class:"p-2 w-8 h-8"}))],10,Z)):b("v-if",!0)],14,P)}}});export{se as _};
